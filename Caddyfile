:80 {
  encode gzip

  @api path /auth/* /channels/* /health
  reverse_proxy @api backend:8002

  @ai path /ai/*
  reverse_proxy @ai ai-service:8001

  @ai_health path /healthz
  reverse_proxy @ai_health ai-service:8001

  @ws path /ws/*
  reverse_proxy @ws backend:8002

  @media_upload path /media/upload
  reverse_proxy @media_upload backend:8002

  @media path /media/*
  reverse_proxy @media media-storage:9101

  handle_path /minio/* {
    reverse_proxy minio:9000
  }

  # Data processor service (document OCR and annotation)
  handle_path /data-processor/healthz {
    rewrite * /healthz
    reverse_proxy data-processor:8003
  }

  handle_path /data-processor/* {
    rewrite * /api{path}
    reverse_proxy data-processor:8003
  }

  reverse_proxy frontend:80
}
