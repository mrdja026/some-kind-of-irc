:80 {
  encode gzip

  @api path /auth/* /channels/* /health
  reverse_proxy @api backend:8002

  @ai path /ai/*
  reverse_proxy @ai ai-service:8001

  @ws path /ws/*
  reverse_proxy @ws backend:8002

  @media_upload path /media/upload
  reverse_proxy @media_upload backend:8002

  @media path /media/*
  reverse_proxy @media media-storage:9101

  # Data processor service (document OCR and annotation)
  @data_processor path /data-processor/*
  handle @data_processor {
    uri strip_prefix /data-processor
    reverse_proxy data-processor:8003
  }

  reverse_proxy frontend:80
}
